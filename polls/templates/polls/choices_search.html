{% extends 'polls/base.html' %}
{% load widget_tweaks %}
{% block content %}
    <div class="container" style="padding-top: 20px">
        <div class="row justify-content-center">
            <div class="col-lg-4 col-md-4 col-sm-8">
                <div class="input-group">
                    <input id="search-term" type="text" class="form-control" placeholder="Search for..." aria-label="Search for...">
                </div> 
            </div>
            <div class="col-lg-4 col-md-4 col-sm-8">
                <div class="input-group">
                    <input id="search-city" type="text" class="form-control" placeholder="Near..." aria-label="Near...">
                    <span class="input-group-btn">
                        <button class="btn btn-primary" type="button">Go!</button>
                    </span>
                </div> 
            </div>
        </div>
        {% comment %} For testing only {% endcomment %}
        <p id="ajax-test"></p>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        let search_term = document.getElementById("search-term");
        let city = document.getElementById("search-city");
        let csrf_token = Cookies.get('csrftoken');
        let test_p = document.getElementById("ajax-test");
        var httpRequest;

        search_term.addEventListener("input", function() {
            let search_data = {
                "search_term": search_term.value,
                "city": city.value,
            }

            httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = populate_with_response;
            httpRequest.open('POST', '/populate_search_box', true);
            httpRequest.setRequestHeader('Content-Type', 'application/json');
            httpRequest.setRequestHeader("X-CSRFToken", csrf_token);
            httpRequest.send(JSON.stringify(search_data));
        })

        function populate_with_response() {
            /* Dummy function for now */
            
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                  var response = httpRequest.responseText;
                  test_p.innerText = response;
                } else {
                  alert('There was a problem with the request.');
                }
            }
        }
    </script>
{% endblock %}

{% block choice_display %}
{% endblock %}
